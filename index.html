<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puzzle Fonctionnel avec Image Complète</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        
        #puzzle-container {
            width: 400px;
            height: 400px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 2px;
            border: 3px solid #34495e;
            margin: 20px 0;
        }
        
        .puzzle-piece {
            background-size: 400px 400px;
            border: 1px solid #fff;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .puzzle-piece:hover {
            transform: scale(1.03);
            z-index: 1;
        }
        
        #empty-piece {
            background-color: #ddd;
        }
        
        #controls {
            margin: 20px 0;
        }
        
        button {
            padding: 10px 20px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Puzzle Classique</h1>
    
    <div id="puzzle-container"></div>
    
    <div id="controls">
        <button id="shuffle-btn">Mélanger</button>
    </div>

    <script>
        // Image test garantie (chaton - licence libre Unsplash)
        const IMAGE_URL = 'https://images.unsplash.com/photo-1514888286974-6c03e2ca1dba?ixlib=rb-1.2.1&auto=format&fit=crop&w=400&h=400&q=80';
        
        // Créer les pièces du puzzle
        function createPuzzle() {
            const container = document.getElementById('puzzle-container');
            container.innerHTML = '';
            
            // Créer 9 pièces (3x3)
            for (let row = 0; row < 3; row++) {
                for (let col = 0; col < 3; col++) {
                    const piece = document.createElement('div');
                    piece.className = 'puzzle-piece';
                    piece.dataset.row = row;
                    piece.dataset.col = col;
                    
                    // Positionner l'image de fond correctement
                    const xPos = -col * (400 / 3);
                    const yPos = -row * (400 / 3);
                    piece.style.backgroundImage = `url('${IMAGE_URL}')`;
                    piece.style.backgroundPosition = `${xPos}px ${yPos}px`;
                    
                    // La dernière pièce est vide
                    if (row === 2 && col === 2) {
                        piece.id = 'empty-piece';
                        piece.style.backgroundImage = 'none';
                    } else {
                        piece.addEventListener('click', movePiece);
                    }
                    
                    container.appendChild(piece);
                }
            }
        }
        
        // Déplacer une pièce
        function movePiece() {
            const emptyPiece = document.getElementById('empty-piece');
            const emptyRow = parseInt(emptyPiece.dataset.row);
            const emptyCol = parseInt(emptyPiece.dataset.col);
            
            const clickedRow = parseInt(this.dataset.row);
            const clickedCol = parseInt(this.dataset.col);
            
            // Vérifier si adjacent à la case vide
            const isAdjacent = 
                (Math.abs(clickedRow - emptyRow) === 1 && clickedCol === emptyCol) ||
                (Math.abs(clickedCol - emptyCol) === 1 && clickedRow === emptyRow);
            
            if (isAdjacent) {
                // Échanger les positions
                [this.dataset.row, emptyPiece.dataset.row] = [emptyPiece.dataset.row, this.dataset.row];
                [this.dataset.col, emptyPiece.dataset.col] = [emptyPiece.dataset.col, this.dataset.col];
                
                // Mettre à jour l'affichage
                updatePiecesPosition();
            }
        }
        
        // Mettre à jour les positions des pièces
        function updatePiecesPosition() {
            document.querySelectorAll('.puzzle-piece').forEach(piece => {
                const row = parseInt(piece.dataset.row);
                const col = parseInt(piece.dataset.col);
                
                const xPos = -col * (400 / 3);
                const yPos = -row * (400 / 3);
                piece.style.backgroundPosition = `${xPos}px ${yPos}px`;
            });
        }
        
        // Mélanger les pièces
        function shufflePieces() {
            // Simple mélange aléatoire
            for (let i = 0; i < 200; i++) {
                const movablePieces = getMovablePieces();
                const randomPiece = movablePieces[Math.floor(Math.random() * movablePieces.length)];
                simulateClick(randomPiece);
            }
        }
        
        function getMovablePieces() {
            const emptyPiece = document.getElementById('empty-piece');
            const emptyRow = parseInt(emptyPiece.dataset.row);
            const emptyCol = parseInt(emptyPiece.dataset.col);
            
            return Array.from(document.querySelectorAll('.puzzle-piece'))
                .filter(piece => {
                    if (piece.id === 'empty-piece') return false;
                    
                    const row = parseInt(piece.dataset.row);
                    const col = parseInt(piece.dataset.col);
                    
                    return (Math.abs(row - emptyRow) === 1 && col === emptyCol) ||
                           (Math.abs(col - emptyCol) === 1 && row === emptyRow);
                });
        }
        
        function simulateClick(piece) {
            const emptyPiece = document.getElementById('empty-piece');
            [piece.dataset.row, emptyPiece.dataset.row] = [emptyPiece.dataset.row, piece.dataset.row];
            [piece.dataset.col, emptyPiece.dataset.col] = [emptyPiece.dataset.col, piece.dataset.col];
            updatePiecesPosition();
        }
        
        // Initialisation
        document.getElementById('shuffle-btn').addEventListener('click', shufflePieces);
        createPuzzle();
    </script>
</body>
</html>
